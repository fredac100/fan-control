#!/bin/bash

if [ "$#" -ne 1 ]; then
    echo "Uso: fan-config <offset>"
    echo ""
    echo "Ajusta a agressividade dos ventiladores:"
    echo "  Valores negativos = Mais silencioso"
    echo "  Valores positivos = Mais agressivo"
    echo ""
    echo "Exemplos:"
    echo "  fan-config -10   # Muito silencioso"
    echo "  fan-config 0     # Padrão"
    echo "  fan-config 15    # Moderadamente agressivo"
    echo "  fan-config 30    # Bem agressivo"
    echo ""
    echo "Status atual:"
    sudo /usr/local/bin/fan_aggressor status | grep -E "Offset|Velocidades|Fan|Temp"
    exit 1
fi

OFFSET=$1

if ! [[ "$OFFSET" =~ ^-?[0-9]+$ ]]; then
    echo "Erro: O offset deve ser um número inteiro"
    exit 1
fi

if [ "$OFFSET" -lt -100 ] || [ "$OFFSET" -gt 100 ]; then
    echo "Erro: O offset deve estar entre -100 e +100"
    exit 1
fi

echo "Configurando offset para $OFFSET%..."
sudo /usr/local/bin/fan_aggressor set both "$OFFSET"

echo "Reiniciando serviço..."
sudo systemctl restart fan-aggressor.service

sleep 3

echo ""
echo "✓ Configuração aplicada!"
echo ""
sudo /usr/local/bin/fan_aggressor status
